diff a/src/wm.c b/src/wm.c	(rejected hunks)
@@ -559,7 +559,7 @@ wm_get_window_title(session_t *ps, Window wid, int *length_return) {
 
 FcChar8 *
 wm_get_desktop_name(session_t *ps, int desktop) {
-    unsigned char *buffer = NULL, *data = NULL;
+    unsigned char *dup, *buffer = NULL, *data = NULL;
     int real_format = 0;
     Atom real_type = None;
     unsigned long items_read = 0, items_left = 0;
@@ -568,16 +568,18 @@ wm_get_desktop_name(session_t *ps, int desktop) {
             &items_read, &items_left, &buffer);
 
     data = buffer;
-    if (Success == status) {
+    if (Success == status && buffer != NULL) {
         for (int i=0; i<desktop; i++) {
-            while (*data != '\0')
-                data++;
+            data = strchr( data, '\0');
             data++;
         }
+        dup = malloc(strlen((char *) data) + 1);
+        strcpy((char *) dup, (char *) data);
+    } else {
+        dup = malloc(snprintf(NULL, 0, "%i", desktop) + 1);
+        sprintf(dup, "%i", desktop);
     }
 
-    unsigned char *dup = malloc(strlen((char *) data) + 1);
-    strcpy((char *) dup, (char *) data);
     XFree(buffer);
     return dup;
 }
